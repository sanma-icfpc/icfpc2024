# ICFPコンテスト2024 - ICFP

URLソース: [https://icfpcontest2024.github.io/icfp.html](https://icfpcontest2024.github.io/icfp.html)

## ICFP言語

### 概要

_Interstellar Communication Functional Program_ (ICFP)は、スペースで区切られた_トークン_のリストで構成されます。_トークン_は、ASCIIコード33（'`!`'）から126（'`~`'）までの印刷可能なASCII文字の1つ以上で構成されます。つまり、94種類の文字があり、_トークン_はこれらの文字の非空シーケンスです。

トークンの最初の文字は_インジケータ_と呼ばれ、トークンの種類を決定します。トークンの残りの部分（空である可能性もあります）は_ボディ_と呼ばれます。異なるトークンの種類は次のセクションで説明されます。

### ブール値

`インジケータ = T` でボディが空の場合は定数 `true` を表し、`インジケータ = F` でボディが空の場合は定数 `false` を表します。

### 整数

`インジケータ = I` は非空のボディを必要とします。

ボディは基数94の数値として解釈されます。例えば、`I/6` は数値 `1337` を表します。

### 文字列

`インジケータ = S`

Cult of the Bound variableは、ASCIIに似たシステムを使用して文字をエンコードしているようですが、順序が若干異なります。具体的には、ボディのASCIIコード33から126までの文字は、次の順序で人間が読めるテキストに変換できます：

```
abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!"#$%&'()*+,-./:;<=>?@[\]^_`|~<space><newline>
```

ここで `<space>` は1つのスペース文字を、`<newline>` は1つの改行文字を表します。例えば、`SB%,,/}Q/2,$_` は文字列 "Hello World!" を表します。

### 単項演算子

`インジケータ = U` は、ボディが正確に1文字である必要があり、その後にICFPが続きます。

| 文字 | 意味 | 例 |
| --- | --- | --- |
| `-` | 整数の否定 | `U- I$` -> `-3` |
| `!` | ブール値の否定 | `U! T` -> `false` |
| `#` | 文字列を基数94の数値として解釈 | `U# S4%34` -> `15818151` |
| `$` | 数値を文字列に変換 | `U$ I4%34` -> `test` |

この表の `->` 記号は「評価結果」を意味します。詳細は[評価](https://icfpcontest2024.github.io/icfp.html#evaluation)を参照してください。

### 二項演算子

`インジケータ = B` は、ボディが正確に1文字である必要があり、その後に2つのICFPが続きます（これらを `x` と `y` と呼びます）。

| 文字 | 意味 | 例 |
| --- | --- | --- |
| `+` | 整数の加算 | `B+ I# I$` -> `5` |
| `-` | 整数の減算 | `B- I$ I#` -> `1` |
| `*` | 整数の乗算 | `B* I$ I#` -> `6` |
| `/` | 整数の除算（ゼロに向かって切り捨て） | `B/ U- I( I#` -> `-3` |
| `%` | 整数の剰余 | `B% U- I( I#` -> `-1` |
| `<` | 整数の比較 | `B< I$ I#` -> `false` |
| `>` | 整数の比較 | `B> I$ I#` -> `true` |
| `=` | 等価比較（整数、ブール値、文字列に対応） | `B= I$ I#` -> `false` |
| `|` | ブール値の論理和 | `B| T F` -> `true` |
| `&` | ブール値の論理積 | `B& T F` -> `false` |
| `.` | 文字列の連結 | `B. S4% S34` -> `"test"` |
| `T` | 文字列 `y` の最初の `x` 文字を取得 | `BT I$ S4%34` -> `"tes"` |
| `D` | 文字列 `y` の最初の `x` 文字を削除 | `BD I$ S4%34` -> `"t"` |
| `$` | 項 `x` を `y` に適用（詳細は[ラムダ抽象](https://icfpcontest2024.github.io/icfp.html#lambda-abstractions)を参照） |  |

### If

`インジケータ = ?` でボディが空の場合、3つのICFPが続きます。最初のICFPがブール値に評価され、`true` なら2番目が評価され、`false` なら3番目が評価されます。例えば：

```
? B> I# I$ S9%3 S./
```

は `no` に評価されます。

### ラムダ抽象

`インジケータ = L` はラムダ抽象を表し、ボディは[整数](https://icfpcontest2024.github.io/icfp.html#integers)と同様に基数94の数値として解釈されます。`インジケータ = v` は変数を表し、ボディも基数94の変数番号です。

ラムダ抽象が二項適用演算子 `$` の最初の引数として現れる場合、適用の2番目の引数がその変数に割り当てられます。例えば、ICFP

```
B$ B$ L# L$ v# B. SB%,,/ S}Q/2,$_ IK
```

は次のプログラムを表します（例えばHaskellスタイルで）

```
((\v2 -> \v3 -> v2) ("Hello" . " World!")) 42
```

これは文字列 `"Hello World!"` に評価されます。

### 評価

最も普及しているICFPメッセージングソフトウェア、Macroware Insightは、ICFPメッセージをコールバイネーム戦略で評価します。これは、二項適用演算子が非厳格であることを意味します。2番目の引数はバインディング変数の場所に置き換えられます（キャプチャ回避の置換を使用）。ラムダ抽象のボディで引数が使用されない場合、その引数は評価されません。変数が複数回使用される場合、式は複数回評価されます。

例えば、評価は次のステップを取ります：

```
B$ L# B$ L" B+ v" v" B* I$ I# v8
B$ L" B+ v" v" B* I$ I#
B+ B* I$ I# B* I$ I#
B+ I' B* I$ I#
B+ I' I'
I-
```

### 制限

地球との通信が複雑であるため、CultはMacroware Insightソフトウェアにいくつかの制限を設けています。具体的には、`10_000_000` ベータ簡約を超えるとメッセージ処理が中止されます。組み込み演算子は厳格であり（もちろん `B$` を除く）、ベータ簡約の制限にはカウントされません。したがって、参加者のメッセージはこれらの制限内に収まる必要があります。

例えば、次の項は `16` に評価され、評価中に `109` ベータ簡約を使用します：

```
B$ B$ L" B$ L# B$ v" B$ v# v# L# B$ v" B$ v# v# L" L# ? B= v# I! I" B$ L$ B+ B$ v" v$ B$ v" v$ B- v# I" I%
```

研究者らは、ベータ削減量の制限が出場者が遭遇する可能性のある唯一の制限であると予想していますが、メモリ使用量と合計実行時間にはいくつかの（未知の）制限もあるようです。

### 不明な演算子

上記の一連の言語構造は研究者が発見したすべてであり、カルトが地球とのコミュニケーションに他のものを使用することは決してないと推測されています。ただし、さらに多くの言語構造が存在するかどうかは不明です。